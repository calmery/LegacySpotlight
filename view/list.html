<html lang="ja">

    <head>
        <meta http-equiv="content-type" content="text/html;charset=utf-8">
        <meta http-equiv="pragma" content="no-cache">
        <meta http-equiv="cache-control" content="no-cache">
        <meta http-equiv="content-style-type" content="text/css">
        <meta http-equiv="content-script-type" content="text/javascript">
        <link rel="stylesheet" href="css/base.css">
        <link rel="stylesheet" href="css/layout.css">
        <script src="js/binding.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script>

            var socketio = io()
            
            var sharedFlg = false

            socketio.emit( 'getList', {
                value: true
            } )
            
            socketio.on( 'processError', function( error ){
                sharedFlg = false
                alert( 'エラーが発生しました．\n\n' + error.value )
            } )

            socketio.on( 'complateShare', function( response ){
                window.location.href = '/edit'
                alert( '共有が完了しました．' )
            } )

            socketio.on( 'gotSharedList', function( data ){
                sessionStorage.setItem( 'editList', data.value )
                window.location.href = '/user'
            } )
            
            socketio.on( 'gotList', function( data ){
                var obj = []
                for( var i=0; i<data.value.length; i++ )
                    obj.push( { name: data.value[i] } )
                bind.binding( 'tweet', obj )
            } )
            
            socketio.on( 'gotListData', function( data ){
                sessionStorage.setItem( 'editList', data.value )
                if( !sharedFlg )
                    window.location.href = '/edit'
            } )

            function getList( val ){
                socketio.emit( 'getListData', {
                    value: val
                } )

                sessionStorage.setItem( 'editName', val )
            }
            
            function share( name ){
                
                if( !confirm('この結果をシェアしますか？') )
                    return false
                
                socketio.emit( 'share', name )
                
                sharedFlg = true
            }
            
            function getShared( num ){
                socketio.emit( 'pullSharedList', num )
                sessionStorage.setItem( 'editName', num )
            }

        </script>

    </head>

    <body>

        <div id="application">

            <div id="nav">
                <div id="appName">SPOTLIGHT</div>
                <a href="/">
                    <div class="menu">メインページ</div>
                </a>
                <a href="/search">
                    <div class="menu">検索</div>
                </a>
                <a href="/list">
                    <div class="menu selected">ランク/リスト</div>
                </a>
                <a href="/setting">
                    <div class="menu">設定</div>
                </a>
            </div>

            <div id="article">
                <div id="header">
                    <div class="htext">
                        RANK / LIST        
                    </div>
                </div>
                <div id="padding">
                    <div class="label">保存したリスト</div>
                    <div id="tweet">
                        <div class="tw2" class="clearfix" onclick="getList('{{name}}')">
                            <div class="clearfix">
                                <div class="postName"><b>{{name}}</b></div>
                                <div style="width:50px;float:left">
                                    <div class="postBtn" onclick="share( '{{name}}' )">共有</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="label">共有ユーザリスト（Beta）</div>
                    <div id="tweet2">
                        <div class="tw2" class="clearfix" onclick="getShared(1)">
                            <div class="clearfix">
                                <div class="postName"><b>Rank 1</b></div>
                                <div style="width:50px;float:left">
                                </div>
                            </div>
                        </div>
                        <div class="tw2" class="clearfix" onclick="getShared(2)">
                            <div class="clearfix">
                                <div class="postName"><b>Rank 2</b></div>
                                <div style="width:50px;float:left">
                                </div>
                            </div>
                        </div>
                        <div class="tw2" class="clearfix" onclick="getShared(3)">
                            <div class="clearfix">
                                <div class="postName"><b>Rank 3</b></div>
                                <div style="width:50px;float:left">
                                </div>
                            </div>
                        </div>
                        <div class="tw2" class="clearfix" onclick="getShared(4)">
                            <div class="clearfix">
                                <div class="postName"><b>Rank 4</b></div>
                                <div style="width:50px;float:left">
                                </div>
                            </div>
                        </div>
                        <div class="tw2" class="clearfix" onclick="getShared(5)">
                            <div class="clearfix">
                                <div class="postName"><b>Rank 5</b></div>
                                <div style="width:50px;float:left">
                                </div>
                            </div>
                        </div>
                        <div class="tw2" class="clearfix" onclick="getShared(6)">
                            <div class="clearfix">
                                <div class="postName"><b>Others</b></div>
                                <div style="width:50px;float:left">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </body>

</html>